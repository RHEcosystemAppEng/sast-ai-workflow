# Process Mining Configuration - Preprocessing Stage
# This file contains configuration for data preprocessing operations

# Pattern Data Preparation Configuration
PATTERN_PREPARATION:
  # Default Directories
  ground_truth_dir: process_mining/data/ground-truth  # Input directory for Excel files
  output_dir: process_mining/data/pattern_data              # Output directory for prepared pattern data

  # RPM Source Handling
  rpm_cache_dir: /tmp/rpm_cache  # Cache directory for RPM source downloads
  default_source_mode: rpm        # Default source fetching mode: "rpm" or "git"

  # False Positive Annotation Values
  # Excel cell values that indicate a false positive classification
  false_positive_markers:
    - "y"
    - "yes"
    - "true"

# Train/Validation/Test Split Configuration
TRAIN_VAL_TEST_SPLIT:
  # Split Ratios (must sum to 1.0)
  train_ratio: 0.60        # 60% train (CLI overridable: --train-ratio)
  validation_ratio: 0.20   # 20% validation (derived from train_ratio)
  test_ratio: 0.20         # 20% test (derived from train_ratio)

  # Validation Tolerances
  split_ratio_tolerance: 0.03     # ±3% tolerance for package/issue count split ratio (CLI overridable: --split-tolerance)
  fp_tp_ratio_tolerance: 0.03     # ±3% tolerance for FP/TP ratio matching (CLI overridable: --fp-tolerance)

  # Random Seed
  random_seed: 43          # Default random seed for reproducibility (CLI overridable: --random-seed)

  # Known Non-Issue Integration
  known_non_issue_dir: process_mining/data/ground-truth/known_non_issue  # Directory with ignore.err files
  require_pairing: false   # If true, exclude packages without both Excel + ignore.err

  # Stratification Settings
  size_categories:
    small_max: 5           # Small packages: 1-5 issues
    medium_max: 20         # Medium packages: 6-20 issues
    # Large packages: >20 issues

  fp_ratio_buckets:
    low_max: 0.25          # Low FP ratio: 0-25%
    high_min: 0.75         # High FP ratio: 75-100%
    # Medium FP ratio: 25-75%

# Data Processing Configuration
# Centralizes constants for file handling, column names, and directory structures
DATA_PROCESSING:
  # Column Name Mappings (normalized to lowercase for case-insensitive matching)
  column_names:
    hint: "hint"
    comment: "comment"
    false_positive: "false positive?"
    finding: "finding"
    issue_id: "issue id"
    ai_prediction: "ai prediction"

  # Directory Names
  directories:
    full_dataset: "full_dataset"
    processed_known_non_issues: "processed_known_non_issues"
    excel_subdir: "excel"
    known_non_issue_subdir: "known_non_issue"

  # File Patterns
  file_patterns:
    excel_extension: ".xlsx"
    temp_file_prefix: "~"
    ignore_err_suffix: "_ignore.err"

# Validation Rules Configuration
# Defines validation requirements and failure categorization
VALIDATION_RULES:
  # Excel File Validation
  excel:
    required_columns: ["finding", "false positive?"]
    justification_columns: ["hint", "comment"]  # At least one required with data
    min_justification_rows: 1  # At least one non-empty justification required

  # ignore.err File Validation
  ignore_err:
    require_justification_comments: true
    justification_marker: "#"

  # Validation Failure Categories
  failure_categories:
    no_justification: "no_justification"
    empty_justification: "empty_justification"
    missing_fp_column: "missing_fp_column"
    empty_fp_annotations: "empty_fp_annotations"
    read_error: "read_error"
    source_unavailable: "source_code_unavailable"
    nvr_parse_error: "nvr_parse_error"
    other: "other"
